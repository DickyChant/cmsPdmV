<!DOCTYPE html>
<html lang="eng" ng-app="testApp" xmlns:ng="http://angularjs.org" id="ng-app">

<head>
  <title>McM - Edit</title>
  <base href="/mcm/">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <link href="scripts/build/mcmcss.css" rel="stylesheet" />
  <link href="scripts/codemirror-3.11/lib/codemirror.css" rel="stylesheet">
  <link href="scripts/codemirror-3.11/theme/eclipse.css" rel="stylesheet">
  <script type="text/javascript" src="scripts/build/mcm.deps1.js"></script>
  <script type="text/javascript" src="scripts/build/mcm.deps2.js"></script>
  <script src="scripts/snow.js"></script>
  <script type="text/javascript">
    var testApp = angular.module('testApp', ['ui.bootstrap']).config(function ($locationProvider) { $locationProvider.html5Mode(true); });
  </script>
  <script src="scripts/main_controller.js"></script>
  <script src="scripts/edit_controller.js"></script>
  <!-- angularui is needed for codemirror -->
  <script src="scripts/codemirror-3.11/lib/codemirror-compressed.js"></script>
  <script src="scripts/angular-ui.min.js"></script>
  <style type="text/css">
    .bs-docs-sidenav>li>a:hover {
      background-color: #F5F5F5;
    }

    .bs-docs-sidenav>li>a {
      border: 1px solid #E5E5E5;
      display: block;
      margin: 0 0 -1px;
      padding: 8px 14px;
    }

    .bs-docs-sidenav {
      background-color: #FFFFFF;
      border-radius: 6px 6px 6px 6px;
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.067);
      margin: 30px 0 0;
      padding: 0;
    }

    table th {
      min-width: 150px;
    }
    input {
      margin: 0 !important;
    }
    input[type="text"] {
      width: calc(100% - 12px);
      padding: 4px 6px;
    }
    input[type="number"] {
      width: calc(50% - 12px);
      padding: 4px 6px;
      text-align: right;
    }
    .table-cell-wrapper > div {
      display: flex;
    }
    .CodeMirror {
      height: auto;
      min-height: 50px;
    }
    table.generator-parameters td {
      border: none;
      padding: 1px 20px 1px 0;
    }
    input.tt-hint {
      display: none !important;
    }
    span.twitter-typeahead {
      margin-top: 2px;
    }
  </style>
</head>

<body ng-controller="mainCtrl">
  <div ng-include="'HTML/navbar_template.html'"></div>
  <span ng-controller="resultsCtrl">
    <div class="container">
      <div class="row">
        <div class="col-md-2 col-sm-12 bs-docs-sidebar ">
          <!--  sidebar span -->
          <ul class="nav nav-list bs-docs-sidenav" style="position: sticky; top: 20px">
            <li class="">
              <a ng-click="saveEditableObject()" title="Save {{prepid}}" ng-href="#">
                <i class="icon-chevron-right"></i>
                Commit
              </a>
            </li>
            <li class="">
              <a ng-href='{{dbName}}?prepid={{prepid}}' title="View {{prepid}}" target="_self">
                <i class="icon-chevron-right"></i>
                View
              </a>
            </li>
            <li ng-show="user.is_production_manager">
              <a ng-click="deleteEditableObject()" title="Delete {{prepid}}" ng-href="#">
                <i class="icon-chevron-right"></i>
                Delete
              </a>
            </li>
            <li>
              <a ng-show="update['success']">
                Updated. Status code: <font color="green">{{update['status_code']}}</font>
              </a>
              <a ng-show="update['fail']">
                Update failed. Message: <font color="red">{{update['message']}}</font>
              </a>
            </li>
            <li class="" ng-show="pendingHTTP">
              <a ng-click="" ng-href="#">
                <img ng-src="https://twiki.cern.ch/twiki/pub/TWiki/TWikiDocGraphics/processing-bg.gif" />
                Pending {{ pendingHTTPLenght }} HTTP request(-s)
              </a>
            </li>
          </ul>
        </div>

        <div class="col-md-8 col-sm-12 ">
          <table class="table table-bordered table-stripped" style="margin: 30px auto">
            <tbody>
              <tr ng-repeat="(attribute, editable) in editingInfo">
                <td style="text-transform: capitalize; white-space: nowrap;">
                  {{attribute.replaceAll('_', ' ')}}
                </td>
                <td style="width: 100%;">
                  <!-- <small style="font-family: monospace;">VALUE: {{editableObject[attribute]}} EDITABLE: {{editable}}</small> -->
                  <div ng-switch on="attribute" class="table-cell-wrapper">
                    <div ng-switch-when="events_per_lumi">
                      <div ng-if="dbName == 'campaigns'">
                        <label>Single core</label>
                        <input type="number"
                               ng-model="editableObject[attribute].singlecore"
                               ng-disabled="!editable">
                        <label>Multi core</label>
                        <input type="number"
                               ng-model="editableObject[attribute].multicore"
                               ng-disabled="!editable">
                      </div>
                      <div ng-if="dbName == 'requests'" style="width: 100%">
                        <edit-events-per-lumi style="width: 100%" ng-model="editableObject[attribute]" editable="editable"></edit-events-per-lumi>
                      </div>
                    </div>
                    <div ng-switch-when="generators">
                      <edit-list-with-suggestions ng-model="editableObject[attribute]"
                                                  style="display: flex; width: 100%"
                                                  editable="editable"
                                                  suggest-attribute="generators"
                                                  limit="20"></edit-list-with-suggestions>
                    </div>
                    <div ng-switch-when="cmssw_release">
                      <edit-attribute-with-suggestions ng-model="editableObject[attribute]"
                                                       style="display: flex; width: 100%"
                                                       editable="editable"
                                                       suggest-database="campaigns"
                                                       suggest-attribute="cmssw_release"
                                                       limit="20"></edit-attribute-with-suggestions>
                    </div>
                    <div ng-switch-when="keep_output">
                      <div ng-if="dbName == 'campaigns'">
                        <div ng-repeat="(name, values) in editableObject[attribute]">
                          {{name}}:
                          <ul>
                            <li ng-repeat="value in values track by $index">
                              <input type="checkbox" ng-model="values[$index]" ng-disabled="!editable"> Sequence {{$index + 1}}
                            </li>
                          </ul>
                        </div>
                      </div>
                      <div ng-if="dbName == 'requests'">
                        <li ng-repeat="value in editableObject[attribute] track by $index">
                          <input type="checkbox" ng-model="editableObject[attribute][$index]" ng-disabled="!editable"> Sequence {{$index + 1}}
                        </li>
                      </div>
                    </div>
                    <div ng-switch-when="notes">
                      <textarea style="display: flex; width: 100%;" ng-model="editableObject[attribute]" ng-disabled="!editable"></textarea>
                    </div>
                    <div ng-switch-when="sequences">
                      <edit-campaign-sequences ng-if="dbName == 'campaigns'" ng-model="editableObject[attribute]" disabled="!editable" campaign="editableObject"></edit-campaign-sequences>
                      <edit-request-sequences ng-if="dbName == 'requests'" ng-model="editableObject[attribute]" disabled="!editable" request="editableObject"></edit-request-sequences>
                    </div>
                    <div ng-switch-when="root">
                      <select ng-model="editableObject[attribute]" ng-disabled="!editable" convert-to-number>
                        <option value="0" ng-selected="editableObject[attribute] == 0">Yes</option>
                        <option value="-1" ng-selected="editableObject[attribute] == -1">Possible</option>
                        <option value="1" ng-selected="editableObject[attribute] == 1">No</option>
                      </select>
                    </div>
                    <div ng-switch-when="type">
                      <select ng-model="editableObject[attribute]" ng-disabled="!editable">
                        <option value="" disabled ng-selected="editableObject[attribute] == ''">Not selected</option>
                        <option value="LHE" ng-selected="editableObject[attribute] == 'LHE'">LHE</option>
                        <option value="Prod" ng-selected="editableObject[attribute] == 'Prod'">Prod</option>
                        <option value="MCReproc" ng-selected="editableObject[attribute] == 'MCReproc'">MCReproc</option>
                      </select>
                    </div>
                    <div ng-switch-when="allowed_campaigns">
                      <edit-list-with-suggestions ng-model="editableObject[attribute]"
                                                  style="display: flex; width: 100%"
                                                  editable="editable"
                                                  suggest-database="campaigns"
                                                  suggest-attribute="prepid"
                                                  limit="20"></edit-list-with-suggestions>
                    </div>
                    <div ng-switch-when="next_campaign">
                      <edit-attribute-with-suggestions ng-model="editableObject[attribute]"
                                                       style="display: flex; width: 100%"
                                                       editable="editable"
                                                       suggest-database="campaigns"
                                                       suggest-attribute="prepid"
                                                       limit="20"></edit-attribute-with-suggestions>
                    </div>
                    <div ng-switch-when="request_parameters">
                      <edit-request-parameters ng-model="editableObject[attribute]"
                                               style="width: 100%;"
                                               editable="editable"></edit-request-parameters>
                    </div>
                    <div ng-switch-when="process_string">
                      <edit-attribute-with-suggestions ng-model="editableObject[attribute]"
                                                       style="display: flex; width: 100%"
                                                       editable="editable"
                                                       suggest-attribute="process_string"
                                                       limit="20"></edit-attribute-with-suggestions>
                    </div>
                    <div ng-switch-when="interested_pwg">
                      <edit-list-with-suggestions ng-model="editableObject[attribute]"
                                                  style="display: flex; width: 100%"
                                                  editable="editable"
                                                  suggest-database="requests"
                                                  suggest-attribute="pwg"
                                                  limit="20"></edit-list-with-suggestions>
                    </div>
                    <div ng-switch-when="fragment" style="max-width: 699px; letter-spacing: -0.25px;">
                      <textarea class="fragment"
                                ng-model="editableObject[attribute]"></textarea>
                    </div>
                    <div ng-switch-when="extension">
                      <select class="input-mini" ng-disabled="!editable" ng-model="editableObject[attribute]" ng-options="key as key for key in [0,1,2,3,4,5]"></select>
                    </div>
                    <div ng-switch-when="mcdb_id">
                      <input type="number"
                             ng-model="editableObject[attribute]"
                             ng-disabled="!editable"
                             min="0"
                             max="100000">
                    </div>
                    <div ng-switch-when="size_event">
                      <edit-size-event editable="editable" ng-model="editableObject[attribute]"></edit-size-event>
                    </div>
                    <div ng-switch-when="time_event">
                      <edit-time-event editable="editable" ng-model="editableObject[attribute]"></edit-time-event>
                    </div>
                    <div ng-switch-when="generator_parameters">
                      <edit-generator-parameters editable="editable" ng-model="editableObject[attribute]"></edit-generator-parameters>
                    </div>
                    <div ng-switch-when="validation">
                      <edit-request-validation editable="editable" ng-model="editableObject[attribute]"></edit-request-validation>
                    </div>
                    <div ng-switch-when="tags">
                      <edit-tags editable="editable" style="display: flex; width: 100%" ng-model="editableObject[attribute]"></edit-tags>
                    </div>

                    <div ng-switch-when="chains">
                      <edit-mccm-chains editable="editable" ng-model="editableObject[attribute]"></edit-mccm-chains>
                    </div>
                    <div ng-switch-when="requests">
                      <edit-mccm-requests editable="editable" ng-model="editableObject[attribute]"></edit-mccm-requests>
                    </div>
                    <div ng-switch-when="block">
                      <select style="margin-bottom: 0;" ng-model="editableObject[attribute]" ng-disabled="!editable" convert-to-number>
                        <option value="0" ng-selected='result[column.db_name] == 0'>0 (not selected)</option>
                        <option value="1" ng-selected='result[column.db_name] == 1'>1 (110k)</option>
                        <option value="2" ng-selected='result[column.db_name] == 2'>2 (90k)</option>
                        <option value="3" ng-selected='result[column.db_name] == 3'>3 (85k)</option>
                        <option value="4" ng-selected='result[column.db_name] == 4'>4 (80k)</option>
                        <option value="5" ng-selected='result[column.db_name] == 5'>5 (70k)</option>
                        <option value="6" ng-selected='result[column.db_name] == 6'>6 (63k)</option>
                      </select>
                    </div>
                    <div ng-switch-when="repetitions">
                      <select style="margin-bottom: 0;"
                              ng-model="editableObject[attribute]"
                              ng-disabled="!editable"
                              ng-options="key as key for key in [1,2,3,4,5,6,7,8,9,10]"></select>
                    </div>

                    <div ng-switch-when="Pwg">
                      <div ng-switch on="dbName">
                        <div ng-switch-when="users">
                          <ul ng-repeat="elem in result[column.db_name]">
                            <li>
                              {{elem}} <a ng-click="removeUserPWG(elem);"><i class="icon-remove-sign"></i></a>
                            </li>
                          </ul>
                          <a ng-click="showAddUserPWG();"><i class="icon-plus" ng-hide="showSelectPWG"></i></a>
                          <select ng-model="selectedPWG" ng-change="addUserPWG(selectedPWG);"
                            ng-options="value for value in all_pwgs" ng-show="showSelectPWG"></select>
                        </div>
                        <div ng-switch-default>
                          <textarea type="text" ng-model="result[column.db_name]"
                            ng-disabled="not_editable_list.indexOf(column.text)!=-1"></textarea>
                        </div>
                      </div>
                    </div>
                    <div ng-switch-when="Value">
                      <!-- <textarea type="text" ng-model="result[column.db_name]" style="width: 390px; height: 20px; margin-bottom: 0px;" ng-disabled="not_editable_list.indexOf(column.text)!=-1"></textarea> -->
                      <ng-form name="fieldForm">
                        <div inline-editable ng-model="result[column.db_name]" column="column.text"></div>
                        <font color="red" ng-show="fieldForm.$invalid">Bad JSON formatting</font>
                      </ng-form>
                    </div>

                    <div ng-switch-when="Role">
                      <select style="margin-bottom: 0;" ng-model="result[column.db_name]"
                        ng-disabled="!user.is_production_manager">
                        <option ng-if="user.is_user" value="user" ng-selected='result[column.db_name] == "user"'>User
                        </option>
                        <option ng-if="user.is_generator_contact" value="generator_contact"
                          ng-selected='result[column.db_name] == "generator_contact"'>Generator Contact</option>
                        <option ng-if="user.is_generator_convener" value="generator_convener"
                          ng-selected='result[column.db_name] == "generator_convener"'>Generator Convener</option>
                        <option ng-if="user.is_production_manager" value="production_manager"
                          ng-selected='result[column.db_name] == "production_manager"'>Production Manager</option>
                        <option ng-if="user.is_production_expert" value="production_expert"
                          ng-selected='result[column.db_name] == "production_expert"'>Production Expert</option>
                        <option ng-if="user.is_administrator" value="administrator"
                          ng-selected='result[column.db_name] == "administrator"'>Administrator</option>
                      </select>
                    </div>
                    <div ng-switch-default>
                      <input ng-if="attributeType(editableObject[attribute]) == 'boolean'"
                             type="checkbox"
                             ng-model="editableObject[attribute]"
                             ng-disabled="!editable">
                      <input ng-if="attributeType(editableObject[attribute]) == 'number'"
                             type="number"
                             ng-model="editableObject[attribute]"
                             ng-disabled="!editable">
                      <input ng-if="attributeType(editableObject[attribute]) == 'string'"
                             type="text"
                             ng-model="editableObject[attribute]"
                             ng-disabled="!editable">
                      <ul ng-if="attributeType(editableObject[attribute]) == 'array'">
                        <li ng-repeat="item in editableObject[attribute]">{{item}}</li>
                      </ul>
                    </div>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <!--END of span12-->
      </div>
    </div>
  </span>
</body>

</html>