<!DOCTYPE html>
<html lang="eng" ng-app="mcmApp" xmlns:ng="http://angularjs.org" id="ng-app">

<head>
  <title>McM - Requests</title>
  <base href="/mcm/">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="scripts/css/bootstrap.min.css">
  <link rel="stylesheet" href="scripts/css/mcm.css" />
  <link rel="stylesheet" href="scripts/codemirror-3.11/lib/codemirror.css">
  <link rel="stylesheet" href="scripts/codemirror-3.11/theme/eclipse.css">
  <link rel="shortcut icon" type="image/x-icon" href="scripts/img/mcm.png">
  <script type="text/javascript" src="scripts/codemirror-3.11/lib/codemirror-compressed.js"></script>
  <script type="text/javascript" src="scripts/angular.min.js"></script>
  <script type="text/javascript" src="scripts/angular-ui.min.js"></script>
  <script type="text/javascript" src="scripts/jquery.js"></script>
  <script type="text/javascript" src="scripts/bootstrap.js"></script>
  <script type="text/javascript" src="scripts/ui-bootstrap-tpls-2.5.0.js"></script>
  <script type="text/javascript" src="scripts/main_controller.js"></script>
  <script type="text/javascript" src="scripts/requests_controller.js"></script>
</head>

<body ng-controller="mainController">
  <div ng-include="'HTML/navbar.html'"></div>
  <div ng-include="'HTML/modals.html'"></div>
  <div ng-controller="requestController">
    <div class="container">
      <column-select update-query="updateQuery" columns="columns"></column-select>
    </div>
    <table class="table table-bordered table-striped table-hover">
      <thead>
        <tr>
          <th ng-repeat="column in columns" ng-if="column.select" style="white-space: nowrap; text-align: center;">
            {{column.text}}
          </th>
        </tr>
      </thead>
      <tbody>
        <tr ng-repeat="data in result">
          <td ng-repeat="column in columns" ng-if="column.select" style="white-space: nowrap;">
            <div ng-switch on="column.db_name">
              <div ng-switch-when="prepid">
                <a ng-href='requests?prepid={{data.prepid}}' title="Show only {{data.prepid}}">{{data.prepid}}</a>
                <custom-actor-list prepid="data[column.db_name]"></custom-actor-list>
                <a ng-if='data.reqmgr_name.length'
                   ng-href='batches?contains={{data.prepid}}'
                   rel="tooltip"
                   title="View batches containing {{data.prepid}}"
                   target="_self"><i class="glyphicon glyphicon-tags"></i></a>
                <a ng-href="https://cms-pdmv.cern.ch/mcm/admin/_utils/#database/requests/{{data[column.db_name]}}"
                   rel="tooltip"
                   title="Admin view of {{data[column.db_name]}}"
                   ng-show="user.is_administrator && !isDevMachine();"><i class="glyphicon glyphicon-star"></i></a>
                <a ng-href="https://cms-pdmv-dev.cern.ch/mcm/admin/_utils/#database/requests/{{data[column.db_name]}}"
                   rel="tooltip"
                   title="Admin view of {{data[column.db_name]}}"
                   ng-show="user.is_administrator && isDevMachine();"><i class="glyphicon glyphicon-star"></i></a>
              </div>
              <div ng-switch-when="">
                <a ng-href='edit?db_name=requests&prepid={{data.prepid}}' rel="tooltip" title="Edit details" ng-hide="role(1);" target="_self">
                  <i class="glyphicon glyphicon-wrench"></i>
                </a>
                <a ng-click='deleteObject(data.prepid)' rel="tooltip" title="Delete request" ng-hide="data.status != 'new' || role(1);" ng-href="#">
                  <i class="glyphicon glyphicon-trash"></i>
                </a>
                <a ng-click="openCloneRequestModal(data)" title="Clone request" ng-hide="role(1);" ng-href="#">
                  <i class="glyphicon glyphicon-duplicate"></i>
                </a>
                <a ng-click="reset([data.prepid])" title="Reset" ng-show="user.is_user" ng-href="#">
                  <i class="glyphicon glyphicon-repeat"></i>
                </a>
                <a ng-click="optionReset([data.prepid])" title="Option Reset" ng-show="user.is_user && data.status == 'new'" ng-href="#">
                  <i class="glyphicon glyphicon-share"></i>
                </a>
                <a ng-click="nextStatus([data.prepid])" title="Next step" ng-show="data.status != 'done' && user.is_user" ng-href="#">
                  <i class="glyphicon glyphicon-chevron-right"></i>
                </a>
                <a ng-href='public/restapi/requests/get/{{data.prepid}}' rel="tooltip" title="Get dictionary" target="_self">
                  <i class="glyphicon glyphicon-download-alt"></i>
                </a>
                <a ng-href='public/restapi/requests/get_setup/{{data.prepid}}' rel="tooltip" title="Get setup command" target="_self">
                  <i class="glyphicon glyphicon-download"></i>
                </a>
                <a ng-href='public/restapi/requests/get_test/{{data.prepid}}' rel="tooltip" title="Get test command" target="_self">
                  <i class="glyphicon glyphicon-ok-circle"></i>
                </a>
                <a ng-href='restapi/requests/get_upload/{{data.prepid}}' rel="tooltip" title="Get upload command" ng-hide="role(3);" target="_self">
                  <i class="glyphicon glyphicon-upload"></i>
                </a>
                <a ng-href='restapi/requests/get_inject/{{data.prepid}}' rel="tooltip" title="Get injection command" ng-hide="role(3);" target="_self">
                  <i class="glyphicon glyphicon-italic"></i>
                </a>
                <a ng-click="objectAction('register', data.prepid)" rel="tooltip" title="Register to the request {{data.prepid}}" ng-href="#">
                  <i class="glyphicon glyphicon-map-marker"></i>
                </a>
                <a ng-click="openNotifyModal(data.prepid)" rel="tooltip" title="Notify" ng-href="#">
                  <i class="glyphicon glyphicon-envelope"></i>
                </a>
                <a ng-click="softReset([data.prepid])" title="Soft Reset" ng-if="user.is_production_manager && data.approval == 'submit'" ng-href="#">
                  <i class="glyphicon glyphicon-step-backward"></i>
                </a>
                <a ng-href='chained_requests?contains={{data.prepid}}' rel="tooltip" title="View chains containing {{data.prepid}}" target="_self">
                  <i class="glyphicon glyphicon-align-left"></i>
                </a>
                <a ng-click="objectAction('inspect', data.prepid)" rel="tooltip" ng-hide="role(3);" title="Inspect status of {{data.prepid}}" ng-href="#">
                  <i class="glyphicon glyphicon-screenshot"></i>
                </a>
                <a ng-click="objectAction('update_stats', data.prepid)" rel="tooltip" ng-hide="role(4);" title="Update status of {{data.prepid}} in Stats" ng-href="#">
                  <i class="glyphicon glyphicon-refresh"></i>
                </a>
                <a ng-click="forcecompletePrompt(data.prepid)" rel="tooltip" ng-if="data.status == 'submitted'" ng-hide="role(1);" title="Add request to be force completed" ng-href="#">
                  <i class="glyphicon glyphicon-gift"></i>
                </a>
                <a ng-href="restapi/requests/gen_log/{{data.prepid}}" rel="tooltip" title="See GEN request checking script logs for {{data.prepid}}" target="_self">
                  <i class="glyphicon glyphicon-th"></i>
                </a>
                <a ng-href="/pmp/present?r={{data.prepid}}" rel="tooltip" title="View announced statistics for {{data.prepid}}" target="_blank">
                  <i class="glyphicon glyphicon-picture"></i>
                </a>
                <a ng-href="/pmp/present?r={{data.prepid}}&m=true" rel="tooltip" title="View growing statistics for {{data.prepid}}" target="_blank">
                  <i class="glyphicon glyphicon-film"></i>
                </a>
                <a ng-show="data.status == 'done' || data.status == 'submitted'" ng-href="/pmp/historical?r={{data.prepid}}" rel="tooltip" title="View historical statistics for {{data.prepid}}" target="_blank">
                  <i class="glyphicon glyphicon-hourglass"></i>
                </a>
                <a ng-if="data.status == 'done' || data.status == 'submitted'" ng-href="{{getLinktoDmytro(data.reqmgr_name)}}" rel="tooltip" title="Computing's monitoring for {{data.prepid}}" target="_blank">
                  <i class="glyphicon glyphicon-camera"></i>
                </a>
                <input type="checkbox" ng-click="add_to_selected_list(data.prepid)" ng-checked="selected_prepids.indexOf(data.prepid) != -1">
                <span ng-show="actionMessage[data.prepid] == 'OK'" style="color: green">{{actionMessage[data.prepid]}}</span>
                <img ng-show="actionMessage[data.prepid] == 'loading'" ng-src="https://twiki.cern.ch/twiki/pub/TWiki/TWikiDocGraphics/processing-bg.gif"/>
                <span ng-show="actionMessage[data.prepid] != 'OK' && actionMessage[data.prepid] != 'loading'" style="color: red">{{actionMessage[data.prepid]}}</span>
              </div>
              <div ng-switch-when="approval" align="center">
                <i class="{{approvalIcon(data[column.db_name])}}" rel="tooltip" title="{{data[column.db_name]}}"></i>
                <a ng-href='{{getLocation()}}&approval={{data[column.db_name]}}' rel="tooltip"
                  title="Show all requests in approval {{data[column.db_name]}}"
                  target="_self">{{data[column.db_name]}}</a>
              </div>
              <div ng-switch-when="status" align="center">
                <i class="{{statusIcon(data[column.db_name])}}" rel="tooltip" title="{{data[column.db_name]}}"></i>
                <a ng-href='{{getLocation()}}&status={{data[column.db_name]}}' rel="tooltip"
                  title="Show all requests in status {{data[column.db_name]}}" target="_self">{{data[column.db_name]}}</a>
              </div>
              <div ng-switch-when="input_dataset">
                <a ng-href='https://cmsweb.cern.ch/das/request?input={{data[column.db_name]}}' rel="tooltip"
                  title="Link to DAS" target="_self">{{data[column.db_name]}}</a>
              </div>
              <div ng-switch-when="pileup_dataset_name">
                <a ng-href='https://cmsweb.cern.ch/das/request?input={{data[column.db_name]}}' rel="tooltip"
                  title="Link to DAS" target="_self">{{data[column.db_name]}}</a>
              </div>
              <div ng-switch-when="dataset_name">
                <a ng-href='requests?dataset_name={{data[column.db_name]}}' rel="tooltip"
                  title="Show requests for {{data[column.db_name]}}" target="_self">{{data[column.db_name]}}</a>
                <!--<a ng-href='{{getLocation()}}&dataset_name={{data[column.db_name]}}' rel="tooltip" title="Show requests for {{data[column.db_name]}}" target="_self">{{data[column.db_name]}}</a>-->
                <a ng-href='chained_requests?dataset_name={{data[column.db_name]}}' rel="tooltip"
                  title="Show chained requests for {{data[column.db_name]}}" target="_self"><i
                    class="glyphicon glyphicon-align-left"></i></a>
              </div>
              <div ng-switch-when="cmssw_release">
                <a ng-href='requests?cmssw_release={{data[column.db_name]}}' rel="tooltip"
                  title="Show requests for {{data[column.db_name]}}" target="_self">{{data[column.db_name]}}</a>
              </div>
              <div ng-switch-when="mcdb_id">
                <a ng-href='requests?mcdb_id={{data[column.db_name]}}' rel="tooltip"
                  title="Show requests for mcdb ID {{data[column.db_name]}}" target="_self">{{data[column.db_name]}}</a>
              </div>
              <div ng-switch-when="pwg">
                <a ng-href='{{getLocation()}}&pwg={{data[column.db_name]}}' rel="tooltip"
                  title="Show all requests for {{data[column.db_name]}}" target="_self">{{data[column.db_name]}}</a>
              </div>
              <div ng-switch-when="notes">
                <pre ng-if="data.notes.length" class="notes">{{data.notes}}</pre>
              </div>
              <div ng-switch-when="sequences">
                <sequence-display ng-model="data.prepid" database="'requests'" prepid="data.prepid"></sequence-display>
              </div>
              <div ng-switch-when="extension" ng-show="data[column.db_name]" align="center">
                <i class="glyphicon glyphicon-ok"></i> Number: {{data[column.db_name]}}
              </div>
              <div ng-switch-when="keep_output" align="center">
                <ul ng-repeat="keep in data[column.db_name] track by $index">
                  <li>{{sequenceName(data.sequences, $index)}}: <i class="glyphicon" ng-class="{'glyphicon-ok' : keep, 'glyphicon-remove' : !keep}"></i></li>
                </ul>
              </div>
              <div ng-switch-when="config_id">
                <ul>
                  <li ng-if="isDevMachine();" ng-repeat="configid in data[column.db_name]">
                    <a ng-href='https://cmsweb-testbed.cern.ch/couchdb/reqmgr_config_cache/{{configid}}/configFile'
                       rel="tooltip"
                       title="View production configuration file {{configid}}"
                       target="_self">
                       <i class="glyphicon glyphicon-th"></i>
                    </a>
                  </li>
                  <li ng-if="!isDevMachine();" ng-repeat="configid in data[column.db_name]">
                    <a ng-href='https://cmsweb.cern.ch/couchdb/reqmgr_config_cache/{{configid}}/configFile'
                       rel="tooltip"
                       title="View production configuration file {{configid}}"
                       target="_self">
                       <i class="glyphicon glyphicon-th"></i>
                    </a>
                  </li>
                </ul>
              </div>
              <div ng-switch-when="flown_with">
                <a ng-show="data[column.db_name]" ng-href='flown_with={{data[column.db_name]}}' title="View requests created with {{data[column.db_name]}}" target="_self">
                  {{data[column.db_name]}}
                </a>
                <a ng-show="data[column.db_name]" ng-href='flows?prepid={{data[column.db_name]}}' title="Show {{data[column.db_name]}}" target="_self">
                  <i class="glyphicon glyphicon-magnet"></i>
                </a>
              </div>
              <div ng-switch-when="output_dataset">
                <ul>
                  <li ng-repeat="ds in data[column.db_name]">
                    <a ng-href='https://cmsweb.cern.ch/das/request?input={{ds}}' rel="tooltip" title="Link to DAS"
                      target="_self">{{ds}}</a>
                  </li>
                </ul>
              </div>
              <div ng-switch-when="generators">
                <ul>
                  <li ng-repeat="gen in data[column.db_name]">
                    {{gen}}
                </ul>
              </div>
              <div ng-switch-when="member_of_chain">
                <ul>
                  <li ng-repeat="chain in data[column.db_name] | orderBy: 'toString()'">
                    <a ng-href='chained_requests?prepid={{chain}}' title="Show {{chain}}" target="_self">{{chain}}<i class="glyphicon glyphicon-align-left"></i></a>
                    <a ng-href='requests?member_of_chain={{chain}}'title="View requests in {{chain}}" target="_self"><i class="glyphicon glyphicon-folder-open"></i></a>
                  </li>
                </ul>
              </div>
              <div ng-switch-when="fragment_tag">
                <div ng-show="data[column.db_name];">
                  <a ng-href='https://raw.githubusercontent.com/cms-sw/genproductions/{{data["fragment_tag"]}}/python/{{data[column.db_name].replace("Configuration/GenProduction/python/", "").replace("Configuration/GenProduction/","")}}' target="_self" ng-show='data["fragment_tag"];'>{{data[column.db_name]}}</a>
                  <a ng-href='https://github.com/cms-sw/genproductions' target="_self" ng-hide='data["fragment_tag"];'>github repo</a>
                </div>
              </div>
              <div ng-switch-when="fragment">
                <fragment-display ng-model="data[column.db_name]" prepid="data.prepid"></fragment-display>
              </div>
              <div ng-switch-when="member_of_campaign">
                <a ng-href='{{getLocation()}}&member_of_campaign={{data[column.db_name]}}' rel="tooltip"
                  title="View request for {{data[column.db_name]}}" target="_self">{{data[column.db_name]}}</a>
                <a ng-href='campaigns?prepid={{data[column.db_name]}}' rel="tooltip"
                  title="View details of the campaign {{data[column.db_name]}}" target="_self"><i
                    class="glyphicon glyphicon-book"></i></a>
              </div>
              <div ng-switch-when="validation">
                <ul>
                  <li ng-show="data[column.db_name].valid != undefined"><i class="glyphicon glyphicon-ok"
                      ng-show="data[column.db_name].valid"></i> <i class="glyphicon glyphicon-remove"
                      ng-show="!data[column.db_name].valid"></i></li>
                  <li ng-show="data[column.db_name].content != undefined">Content: {{data[column.db_name].content}}</li>
                  <!-- #PG <li ng-show="data[column.db_name].nEvents != undefined">{{numberWithCommas(data[column.db_name].nEvents)}} events</li> -->
                  <li ng-show="data[column.db_name].valid"> DQM
                    <a ng-show="isDevMachine()"
                      href="https://cmsweb.cern.ch/dqm/relval/start?runnr=1;dataset={{data[column.db_name].dqm}};;sampletype=offline_relval;filter=all;referencepos=overlay;referenceshow=all;referencenorm=True;referenceobj1=other%3A%3A{{data[column.db_name].ref_dqm}}%3AReference%3A;referenceobj2=none;referenceobj3=none;referenceobj4=none;search=;striptype=object;stripruns=;stripaxis=run;stripomit=none;workspace=Everything;size=M;root=Generator;focus=;zoom=no;"
                      rel="tooltip" title="Go to the DQM gui for {{data[column.db_name].dqm}}" target="_blank"><i
                        class="glyphicon glyphicon-th-large"></i></a>
                    <a ng-show="!isDevMachine()"
                      href="https://cmsweb.cern.ch/dqm/relval/start?runnr=1;dataset={{data[column.db_name].dqm}};;sampletype=offline_relval;filter=all;referencepos=overlay;referenceshow=all;referencenorm=True;referenceobj1=other%3A%3A{{data[column.db_name].ref_dqm}}%3AReference%3A;referenceobj2=none;referenceobj3=none;referenceobj4=none;search=;striptype=object;stripruns=;stripaxis=run;stripomit=none;workspace=Everything;size=M;root=Generator;focus=;zoom=no;"
                      rel="tooltip" title="Go to the DQM gui for {{data[column.db_name].dqm}}" target="_blank"><i
                        class="glyphicon glyphicon-th-large"></i></a>
                  </li>
                  <li ng-show="data[column.db_name].peak_value_rss">
                    Peak RSS value: {{data[column.db_name].peak_value_rss}}MB
                  </li>
                  <li ng-show="data[column.db_name].time_multiplier != undefined">
                    Length: {{data[column.db_name].time_multiplier}} * 8h = {{8 * data[column.db_name].time_multiplier}}h
                  </li>
                  <li ng-show="data[column.db_name].results">
                    Results:
                    <ul>
                      <li ng-repeat="(threads, threadsResult) in data[column.db_name].results">
                        Threads {{threads}}:
                        <ul ng-if="threadsResult.length !== undefined && threadsResult.length > 1">
                          <li ng-repeat="sequence in threadsResult">
                            Sequence {{$index + 1}}:
                            <ul>
                              <li>Events: {{sequence.total_events}}</li>
                              <li>CPU Efficiency: {{(sequence.cpu_efficiency) * 100 | number:1}} %</li>
                              <li>Est. events/lumi: {{sequence.estimated_events_per_lumi | number:1}}</li>
                              <li>Peak Value RSS: {{sequence.peak_value_rss | number:2}} MB</li>
                              <li>Filter efficiency: {{(sequence.filter_efficiency) * 100 | number:1}} %</li>
                              <li>Time per event: {{sequence.time_per_event | number:4}} s</li>
                              <li>Size per event: {{sequence.size_per_event | number:4}} kB</li>
                              <li ng-if="sequence.cpu_name">CPU Name: {{sequence.cpu_name}}</li>
                            </ul>
                          </li>
                        </ul>
                        <ul ng-if="threadsResult.length !== undefined || threadsResult.length == 1">
                          <li>Events: {{threadsResult[0].total_events}}</li>
                          <li>CPU Efficiency: {{(threadsResult[0].cpu_efficiency) * 100 | number:1}} %</li>
                          <li>Est. events/lumi: {{threadsResult[0].estimated_events_per_lumi | number:1}}</li>
                          <li>Peak Value RSS: {{threadsResult[0].peak_value_rss | number:2}} MB</li>
                          <li>Filter efficiency: {{(threadsResult[0].filter_efficiency) * 100 | number:1}} %</li>
                          <li>Time per event: {{threadsResult[0].time_per_event | number:4}} s</li>
                          <li>Size per event: {{threadsResult[0].size_per_event | number:4}} kB</li>
                          <li ng-if="threadsResult[0].cpu_name">CPU Name: {{threadsResult[0].cpu_name}}</li>
                        </ul>
                        <ul ng-if="threadsResult.length === undefined">
                          <li>Events: {{threadsResult.total_events}}</li>
                          <li>CPU Efficiency: {{(threadsResult.cpu_efficiency) * 100 | number:1}} %</li>
                          <li>Est. events/lumi: {{threadsResult.estimated_events_per_lumi | number:1}}</li>
                          <li>Peak Value RSS: {{threadsResult.peak_value_rss | number:2}} MB</li>
                          <li>Filter efficiency: {{(threadsResult.filter_efficiency) * 100 | number:1}} %</li>
                          <li>Time per event: {{threadsResult.time_per_event | number:4}} s</li>
                          <li>Size per event: {{threadsResult.size_per_event | number:4}} kB</li>
                          <li ng-if="threadsResult.cpu_name">CPU Name: {{threadsResult.cpu_name}}</li>
                        </ul>

                      </li>
                    </ul>
                  </li>
                </ul>
              </div>
              <div ng-switch-when="history">
                <div custom-history ng-model="data[column.db_name]"></div>
              </div>
              <div ng-switch-when="total_events">
                {{numberWithCommas(data[column.db_name])}}
              </div>
              <div ng-switch-when="completed_events">
                {{numberWithCommas(data[column.db_name])}}
              </div>
              <div ng-switch-when="reqmgr_name">
                <reqmgr-Name ng-model="data[column.db_name]" prepid="data.prepid"></reqmgr-Name>
              </div>
              <div ng-switch-when="memory">
                {{data[column.db_name]}}
                <span class="label label-info" ng-show="data[column.db_name]" title="Megabytes">MB<span>
              </div>
              <div ng-switch-when="size_event">
                <ul>
                  <li ng-repeat="value in data[column.db_name] track by $index">
                    {{sequenceName(data.sequences, $index)}}: {{value}} kB
                  </li>
                </ul>
              </div>
              <div ng-switch-when="time_event">
                <ul>
                  <li ng-repeat="value in data[column.db_name] track by $index">
                    {{sequenceName(data.sequences, $index)}}: {{value}} s
                  </li>
                </ul>
              </div>
              <div ng-switch-when="events_per_lumi">
                <span ng-show="data[column.db_name] != 0">{{data[column.db_name]}}</span>
                <span ng-show="data[column.db_name] == 0">Use campaign value</span>
              </div>
              <div ng-switch-when="interested_pwg">
                <ul>
                  <li ng-repeat="elem in data[column.db_name]">
                    {{elem}}
                  </li>
                </ul>
              </div>
              <div ng-switch-when="pilot">
                <i class="glyphicon" ng-class="{'glyphicon-ok' : data[column.db_name], 'glyphicon-remove' : !data[column.db_name]}"></i>
              </div>
              <div ng-switch-when="tags">
                <a ng-repeat="tag in data[column.db_name]" ng-href="{{database}}?tags={{tag}}">
                  {{tag}}
                </a>
              </div>
              <div ng-switch-default>
                <a ng-href='{{database}}?{{column.db_name}}={{data[column.db_name]}}'
                   title="Show all {{database.replace('_', ' ')}} where {{column.text}} is {{data[column.db_name]}}">
                   {{data[column.db_name]}}
                </a>
              </div>
            </div>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Notify MODAL-->
    <script type="text/ng-template" id="notifyModal.html"> <!--hidden modal template-->
    <div class="modal-header">
      <h4>Text to notify</h4>
    </div>
    <!--end of modal header-->
    <div class="modal-body">
      <textarea ng-model="data.text" style="width:500px"></textarea>
    </div>
    <!--end of modal body-->
    <div class="modal-footer">
      <button class="btn btn-success" ng-click="notify()" ng-disabled="data.text.length == 0">Notify</button>
      <button class="btn btn-warning cancel" ng-click="close()">Close</button>
    </div>
    <!--end of modal footer-->
    </script>
    <!-- END of Notify MODAL-->

    <!--     Clone MODAL -->
    <script type="text/ng-template" id="cloneRequestModal.html"> <!--hidden modal template-->
    <div class="modal-header">
      <h4>Clone request {{request.prepid}}</h4>
    </div>
    <div class="modal-body">
      <select ng-model="vars.pwg">
        <option ng-repeat="elem in allPWGs" ng-selected="elem == vars.pwg">{{elem}}</option>
      </select>
      <select ng-model="vars.campaign">
        <option ng-repeat="elem in allCampaigns" ng-selected="elem == vars.campaign">{{elem}}</option>
      </select>
    </div>
    <div class="modal-footer">
      <button class="btn btn-success" ng-click="clone()">Clone</button>
      <button class="btn btn-warning cancel" ng-click="close()">Close</button>
    </div>
    </script>
    <!--     END OF MODAL  -->

    <div class="row-fluid custom-footer">
      <div>
        <span>
          Multiple selection buttons
          <a ng-href='edit_many?db_name=requests&prepid={{selected_prepids.join()}}' rel="tooltip" title="Edit details" ng-hide="role(1);" target="_self">
            <i class="glyphicon glyphicon-wrench"></i>
          </a>
          <a ng-click="actionPrompt('reset', 'selected')" rel="tooltip" ng-hide="role(1);" title="Reset selected requests" ng-href="#">
            <i class="glyphicon glyphicon-repeat"></i>
          </a>
          <a ng-click="actionPrompt('option_reset', 'selected')" rel="tooltip" ng-if="user.is_user"  title="Option Reset selected requests" ng-href="#">
            <i class="glyphicon glyphicon-share"></i>
          </a>
          <a ng-click="actionPrompt('approve', 'selected')" rel="tooltip" title="Next step for selected requests" ng-hide="role(1);" ng-href="#">
            <i class="glyphicon glyphicon-chevron-right"></i>
          </a>
          <a ng-click="objectAction('register', 'selected')" rel="tooltip" title="Register to selected requests" ng-href="#">
            <i class="glyphicon glyphicon-map-marker"></i>
          </a>
          <a ng-click="openNotifyModal(data.prepid)" rel="tooltip" title="Notify selected prepids" ng-href="#">
            <i class="glyphicon glyphicon-envelope"></i>
          </a>
          <a ng-click="actionPrompt('soft_reset', 'selected')" rel="tooltip" ng-hide="role(3);" title="Soft reset selected requests" ng-href="#">
            <i class="glyphicon glyphicon-step-backward"></i>
          </a>
          <a ng-click="objectAction('inspect', 'selected')" rel="tooltip" ng-hide="role(3);" title="Inspect status of selected requests" ng-href="#">
            <i class="glyphicon glyphicon-screenshot"></i>
          </a>
          <a ng-click="objectAction('update_stats', 'selected')" rel="tooltip" ng-hide="role(4);" title="Update status of selected requests in Stats" ng-href="#">
            <i class="glyphicon glyphicon-refresh"></i>
          </a>
          <a ng-click="openOnlySelected();" rel="tooltip" ng-hide="role(1);" title="View only selected prepids" ng-href="#">
            <i class="glyphicon glyphicon-th-list"></i>
          </a>
          <a ng-href="/pmp/present?r={{selected_prepids.join()}}" rel="tooltip" title="View announced statistics for selected prepids" target="_blank">
            <i class="glyphicon glyphicon-picture"></i>
          </a>
          <a ng-href="/pmp/present?r={{selected_prepids.join()}}&m=true" rel="tooltip" title="View growing statistics for selected prepids" target="_blank">
            <i class="glyphicon glyphicon-film"></i>
          </a>
          <a ng-href="/pmp/historical?r={{selected_prepids.join()}}" rel="tooltip" title="View historical statistics for selected prepids" target="_blank">
            <i class="glyphicon glyphicon-hourglass"></i>
          </a>
          <input type="checkbox" value="ToggleAll" ng-click="toggleAll()" rel="tooltip" title="Toggle select all" style="margin-bottom: 8px;" ng-checked="result.length == selected_prepids.length">
        </span>
      </div>

    </div>
  </span>
</body>

</html>
